import{K as Q,I as W,r as s,y as J,H as re,B as le,c,h as L,e as n,b as r,g as _,w as se,t as g,d as N,v as A,n as E,L as ae,i as oe,p as q,l as K,m as ne,o as m}from"./index-CwaQPSV_.js";import{u as X,a as Y,s as Z,l as ee,h as C,b as z,d as te}from"./functions-BSmh5TsC.js";import{H as de,U as ie}from"./Header-Cl2YdGa1.js";import{T as ue}from"./Top-B3CFE1E3.js";const ce=Q("role",()=>{const f=W(),M=s([{title:"ID",align:"left",key:"id"},{title:"NOMBRE",align:"left",key:"name"},{title:"APELLIDO",align:"end",key:"last_name"},{title:"FECHA DE NACIMIENTO",align:"end",key:"date_of_birth_format"},{title:"DPI",align:"end",key:"dpi"},{title:"NIT",align:"end",key:"nit"},{title:"FOTO",align:"middle",key:"profile_picture_url"},{title:"ESTADO",align:"middle",key:"state"},{title:"ACCIONES",align:"end",key:"actions",sort:!0}]);let l=s([]),t=s([]),v=s(null),h=s([]),i=s(!1),D=s([]),T=s(!1),O=s(!1),U=s(!1),o=s(!1),e=s(!1),I=s(!1),w=s(!1),a=s(!1),P=J({name:"",last_name:"",code_job:"",email:"",ethnic_group:"",profile_picture_url:"",manager_id:""}),R=s(null);function j(b,y=null){switch(h.value=y,b){case 1:o.value=!0;break;case 2:U.value=!0;break;case 3:e.value=!0;break;case 4:optionRol.value=!0;break}O.value=!0}async function F(){i.value=!0,l.value="",D.value=[];try{D.value=await X("roles")}catch{l.value="No se pudieron cargar los registros."}finally{i.value=!1}}async function G(){i.value=!0,l.value="",h.value=[];let b=JSON.parse(localStorage.getItem("user"));try{h.value=await Y("personal_details",b==null?void 0:b.id)}catch{l.value="No se pudieron cargar los registros."}finally{i.value=!1}}async function B(){var b,y;o.value=!0,l.value="",t.value=[];try{const k="personal_details",S={...P};S.profile_picture_url=R.value;const d=await Z.store(k,S,!0);f.setAlert(((b=d.data)==null?void 0:b.message)||"Detalles personales creados exitosamente.","success","Éxito"),o.value=!1,this.index(),ee(P)}catch(k){t.value=(y=k.response)==null?void 0:y.data.errors,console.log(k),C(k,f.setAlert)}}async function H(){var b;U.value=!0,l.value="",t.value=[];try{const y="personal_details/"+h.value.id,k={...h.value};k.user_id=h.value.id;const S=await z.update(y,k,!1);f.setAlert(((b=S.data)==null?void 0:b.message)||"Detalles personales actualizados exitosamente.","success","Éxito")}catch(y){t.value=y.response.data.errors,console.log(y.response.data.errors),C(y,f.setAlert)}finally{U.value=!1}}async function $(){var b,y,k;a.value=!0,l.value="",t.value=[];try{const S="personal_details/"+h.value.id,d=await te.destroy(S);f.setAlert(((b=d.data)==null?void 0:b.message)||"Detalles personales eliminados exitosamente.","success","Éxito"),e.value=!1,this.index()}catch(S){t.value=((k=(y=S.response)==null?void 0:y.data)==null?void 0:k.errors)||[],console.log(t.value),C(S,f.setAlert)}finally{a.value=!1}}return{errors:l,validationErrors:t,headers:M,records:D,loadingRecords:T,record:h,loadingRecord:i,loadingOptions:O,id:v,optionUpdate:U,optionNew:o,optionDelete:e,buttonUpdate:I,buttonNew:w,buttonDelete:a,newRecord:P,file:R,options:j,index:F,show:G,store:B,update:H,destroy:$}}),me=Q("user",()=>{const f=W(),M=ce(),l=s([{title:"ID",align:"left",key:"id"},{title:"DESCRIPCIÓN",align:"left",key:"name"},{title:"ESTADO",align:"middle",key:"state"},{title:"ACCIONES",align:"end",key:"actions",sort:!0}]);let t=s([]),v=s([]),h=s(null),i=s([]),D=s(!1),T=s([]),O=s(!1),U=s(!1),o=s(!1),e=s(!1),I=s(!1),w=s(!1),a=s(!1),P=s(!1),R=s(!1),j=s(!1),F=J({name:"",last_name:"",code_job:"",email:"",ethnic_group:"",profile_picture_url:"",manager_id:""});function G(d,p=null){switch(i.value=p,d){case 1:e.value=!0;break;case 2:o.value=!0;break;case 3:I.value=!0;break;case 4:w.value=!0,M.index();break}U.value=!0}async function B(){D.value=!0,t.value="",T.value=[];try{T.value=await X("personal_details")}catch{t.value="No se pudieron cargar los registros."}finally{D.value=!1}}async function H(){D.value=!0,t.value="",i.value=[];let d=JSON.parse(localStorage.getItem("user"));try{i.value=await Y("personal_details",d==null?void 0:d.id)}catch{t.value="No se pudieron cargar los registros."}finally{D.value=!1}}async function $(){var d,p;e.value=!0,t.value="",v.value=[];try{const u="personal_details",x={...F};x.profile_picture_url=file.value;const V=await Z.store(u,x,!0);f.setAlert(((d=V.data)==null?void 0:d.message)||"Detalles personales creados exitosamente.","success","Éxito"),e.value=!1,this.index(),ee(F)}catch(u){v.value=(p=u.response)==null?void 0:p.data.errors,console.log(u),C(u,f.setAlert)}}async function b(){var d;o.value=!0,t.value="",v.value=[];try{const p="personal_details/"+i.value.id,u={...i.value};u.user_id=i.value.id;const x=await z.update(p,u,!1);f.setAlert(((d=x.data)==null?void 0:d.message)||"Detalles personales actualizados exitosamente.","success","Éxito")}catch(p){v.value=p.response.data.errors,console.log(p.response.data.errors),C(p,f.setAlert)}finally{o.value=!1}}async function y(){var d,p,u;R.value=!0,t.value="",v.value=[];try{const x="personal_details/"+i.value.id,V=await te.destroy(x);f.setAlert(((d=V.data)==null?void 0:d.message)||"Detalles personales eliminados exitosamente.","success","Éxito"),I.value=!1,this.index()}catch(x){v.value=((u=(p=x.response)==null?void 0:p.data)==null?void 0:u.errors)||[],console.log(v.value),C(x,f.setAlert)}finally{R.value=!1}}async function k(){var d,p;o.value=!0,t.value="",v.value=[];try{const u="admin/personal_details/"+i.value.id,x={...i.value};x.user_id=i.value.id,x.profile_picture_url=file.value;const V=await z.update(u,x,!0);f.setAlert(((d=V.data)==null?void 0:d.message)||"Detalles personales actualizados exitosamente.","success","Éxito"),o.value=!1,this.index()}catch(u){v.value=(p=u.response)==null?void 0:p.data.errors,console.log(u),C(u,f.setAlert)}}async function S(){var d,p;j.value=!0,t.value="",v.value=[];try{const u="users/assign_role/"+i.value.id,x={...i.value},V=await z.update(u,x,!1);f.setAlert(((d=V.data)==null?void 0:d.message)||"Rol agregado exitosamente.","success","Éxito"),w.value=!1,this.index()}catch(u){v.value=(p=u.response)==null?void 0:p.data.errors,console.log(u),C(u,f.setAlert)}finally{j.value=!1}}return{errors:t,validationErrors:v,headers:l,records:T,loadingRecords:O,record:i,loadingRecord:D,loadingOptions:U,id:h,optionUpdate:o,optionNew:e,optionDelete:I,optionRol:w,buttonUpdate:a,buttonNew:P,buttonDelete:R,buttonRol:j,newRecord:F,options:G,index:B,show:H,store:$,update:b,destroy:y,updateAdmin:k,assignRole:S}}),pe={key:0,class:"bg-gradient-to-br from-blue-50 to-indigo-100"},fe={class:"container mx-auto py-10 px-4 md:px-6"},be={class:"max-w-2xl mx-auto"},ge={class:"bg-white rounded-lg shadow-md p-6"},ve={class:"flex justify-center mb-6"},ye={class:"flex flex-col items-center gap-4"},xe={class:"relative"},_e={class:"h-32 w-32 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center"},he=["src"],we={key:1,class:"text-gray-400 text-2xl"},ke={key:0,class:"text-red-500 text-sm mt-1"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={key:0,class:"text-red-500 text-sm mt-1"},Ae={key:0,class:"text-red-500 text-sm mt-1"},De={key:0,class:"text-red-500 text-sm mt-1"},Se={key:0,class:"text-red-500 text-sm mt-1"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ie={key:0,class:"text-red-500 text-sm mt-1"},Ce={key:0,class:"text-red-500 text-sm mt-1"},Te={key:0,class:"text-red-500 text-sm mt-1"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Oe={key:0,class:"text-red-500 text-sm mt-1"},Re={key:0,class:"text-red-500 text-sm mt-1"},Me={key:0,class:"text-red-500 text-sm mt-1"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je={key:0,class:"text-red-500 text-sm mt-1"},Fe={key:0,class:"text-red-500 text-sm mt-1"},Le={key:0,class:"text-red-500 text-sm mt-1"},ze=["disabled"],Ge={key:0,class:"fixed bottom-4 left-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg"},Be={key:1,class:"flex items-center justify-center min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6"},He={class:"w-full max-w-md space-y-8"},$e={class:"text-center"},Je={class:"relative mx-auto w-24 h-24 mb-6"},qe={class:"absolute inset-2 rounded-full bg-white shadow-lg flex items-center justify-center"},Ke={class:"absolute -bottom-2 left-1/2 transform -translate-x-1/2"},Qe={class:"bg-white rounded-full px-3 py-1 shadow-lg border"},We={class:"text-sm font-semibold text-slate-700"},Xe={class:"space-y-2"},Ye={class:"w-full bg-slate-200 rounded-full h-3 overflow-hidden"},Ze={class:"flex justify-center space-x-2"},st={__name:"ProfileView",setup(f,{expose:M}){const l=me(),t=J({avatar:"",firstName:"",lastName:"",email:"",email_personal:"",phone:"",gender:"",address:"",birthday:"",dpi:"",nit:"",city:"",department:"",country:""}),v=re(()=>{var o;return"/auditoria/public/storage/"+((o=l.record)==null?void 0:o.profile_picture_url)}),h=s(0),i=s(!1),D=s(!1),T=s("");M({progress:h});const O=()=>{let o=!0;if(Object.keys(t).forEach(w=>{t[w]=""}),(!l.record.name||l.record.name.length<2)&&(t.firstName="El nombre debe tener al menos 2 caracteres.",o=!1),(!l.record.last_name||l.record.last_name.length<2)&&(t.lastName="El apellido debe tener al menos 2 caracteres.",o=!1),!l.record.date_of_birth)t.birthday="La fecha de nacimiento es obligatoria.",o=!1;else{const w=new Date(l.record.date_of_birth);(isNaN(w.getTime())||w.toISOString().slice(0,10)!==l.record.date_of_birth)&&(t.birthday="La fecha debe ser válida y en formato AAAA-MM-DD.",o=!1)}const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;(!l.record.email||!e.test(l.record.email))&&(t.email="Por favor ingresa un correo electrónico válido.",o=!1);const I=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return(!l.record.email_personal||!I.test(l.record.email_personal))&&(t.email_personal="Por favor ingresa un correo electrónico válido.",o=!1),(!l.record.phone_number||l.record.phone_number.length<8)&&(t.phone="El número de teléfono debe tener al menos 8 dígitos.",o=!1),(!l.record.gender||l.record.gender.length<1)&&(t.gender="El Genero es requerido.",o=!1),(!l.record.dpi||l.record.dpi.length!==13)&&(t.dpi="El número de CUI debe tener 13 dígitos.",o=!1),(!l.record.nit||l.record.nit.length<3)&&(t.nit="El número de NIT debe tener al menos 3 dígitos.",o=!1),(!l.record.address||l.record.address.length<5)&&(t.address="La dirección debe tener al menos 5 caracteres.",o=!1),(!l.record.city||l.record.city.length<4)&&(t.city="El municipio debe tener al menos 4 caracteres.",o=!1),(!l.record.department||l.record.department.length<4)&&(t.department="El departamento debe tener al menos 4 caracteres.",o=!1),(!l.record.country||l.record.country.length<4)&&(t.country="El pais debe tener al menos 4 caracteres.",o=!1),o},U=async()=>{if(O()){i.value=!0;try{await l.update()}catch(o){console.error("Error al enviar el formulario:",o)}finally{i.value=!1}}};return le(()=>{l.show()}),(o,e)=>{var w;const I=oe("Errors");return m(),c(K,null,[L(de),n(l).loadingRecord?(m(),c("div",Be,[r("div",He,[r("div",$e,[r("div",Je,[e[28]||(e[28]=r("div",{class:"absolute inset-0 rounded-full border-4 border-slate-200"},null,-1)),e[29]||(e[29]=r("div",{class:"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-500 animate-spin",style:{"animation-duration":"2s"}},null,-1)),r("div",qe,[L(n(ie),{class:"w-8 h-8 text-slate-600"})]),r("div",Ke,[r("div",Qe,[r("span",We,g(Math.round(h.value))+"%",1)])])]),e[30]||(e[30]=r("h2",{class:"text-2xl font-bold text-slate-800 mb-2"},"Cargando Perfil",-1)),e[31]||(e[31]=r("p",{class:"text-slate-600"},"Preparando tu información personal",-1))]),r("div",Xe,[r("div",Ye,[r("div",{class:"h-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-full transition-all duration-300 ease-out relative",style:q({width:`${h.value}%`})},e[32]||(e[32]=[r("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"},null,-1)]),4)])]),r("div",Ze,[(m(),c(K,null,ne(5,a=>r("div",{key:a,class:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:q({animationDelay:`${(a-1)*.15}s`,animationDuration:"1.2s"})},null,4)),64))]),e[33]||(e[33]=r("div",{class:"text-center"},[r("p",{class:"text-sm text-slate-500 animate-pulse"},"Cargando datos del perfil...")],-1))])])):(m(),c("div",pe,[r("div",fe,[r("div",be,[e[27]||(e[27]=r("h1",{class:"text-3xl font-bold mb-6 text-center"},"Perfil de Usuario",-1)),r("div",ge,[r("form",{onSubmit:se(U,["prevent"]),class:"space-y-6"},[r("div",ve,[r("div",ye,[r("div",xe,[r("div",_e,[(w=n(l).record)!=null&&w.profile_picture_url?(m(),c("img",{key:0,src:v.value,alt:"Foto de perfil",class:"h-full w-full object-cover"},null,8,he)):(m(),c("span",we,"?"))])]),t.avatar?(m(),c("p",ke,g(t.avatar),1)):_("",!0)])]),r("div",Ne,[r("div",null,[e[13]||(e[13]=r("label",{for:"firstName",class:"block text-sm font-medium text-gray-700 mb-1"},"Nombres",-1)),N(r("input",{id:"firstName","onUpdate:modelValue":e[0]||(e[0]=a=>n(l).record.name=a),type:"text",placeholder:"Juan",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.firstName}]),readonly:"",disabled:""},null,2),[[A,n(l).record.name]]),t.firstName?(m(),c("p",Ee,g(t.firstName),1)):_("",!0)]),r("div",null,[e[14]||(e[14]=r("label",{for:"lastName",class:"block text-sm font-medium text-gray-700 mb-1"},"Apellidos",-1)),N(r("input",{id:"lastName","onUpdate:modelValue":e[1]||(e[1]=a=>n(l).record.last_name=a),type:"text",placeholder:"Pérez",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.lastName}]),disabled:""},null,2),[[A,n(l).record.last_name]]),t.lastName?(m(),c("p",Ae,g(t.lastName),1)):_("",!0)])]),r("div",null,[e[15]||(e[15]=r("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"Correo Electrónico Municipal",-1)),N(r("input",{id:"email","onUpdate:modelValue":e[2]||(e[2]=a=>n(l).record.email=a),type:"email",placeholder:"juan.perez@ejemplo.com",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.email}]),disabled:""},null,2),[[A,n(l).record.email]]),t.email?(m(),c("p",De,g(t.email),1)):_("",!0)]),r("div",null,[e[16]||(e[16]=r("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha de nacimiento",-1)),N(r("input",{id:"phone","onUpdate:modelValue":e[3]||(e[3]=a=>n(l).record.date_of_birth=a),type:"date",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.birthday}])},null,2),[[A,n(l).record.date_of_birth]]),t.birthday?(m(),c("p",Se,g(t.birthday),1)):_("",!0)]),r("div",Ue,[r("div",null,[e[17]||(e[17]=r("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),N(r("input",{id:"phone","onUpdate:modelValue":e[4]||(e[4]=a=>n(l).record.phone_number=a),type:"text",placeholder:"12345678",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.phone}])},null,2),[[A,n(l).record.phone_number]]),t.phone?(m(),c("p",Ie,g(t.phone),1)):_("",!0)]),r("div",null,[e[19]||(e[19]=r("label",{for:"lastName",class:"block text-sm font-medium text-gray-700 mb-1"},"Genero",-1)),N(r("select",{class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.gender}]),"onUpdate:modelValue":e[5]||(e[5]=a=>n(l).record.gender=a)},e[18]||(e[18]=[r("option",{disabled:"",selected:""},"--Seleccione--",-1),r("option",{value:"M"},"MASCULINO",-1),r("option",{value:"F"},"FEMENIMO",-1)]),2),[[ae,n(l).record.gender]]),t.gender?(m(),c("p",Ce,g(t.gender),1)):_("",!0)])]),r("div",null,[e[20]||(e[20]=r("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"Correo Electrónico Personal",-1)),N(r("input",{id:"email","onUpdate:modelValue":e[6]||(e[6]=a=>n(l).record.email_personal=a),type:"email",placeholder:"juan.perez@ejemplo.com",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.email_personal}])},null,2),[[A,n(l).record.email_personal]]),t.email_personal?(m(),c("p",Te,g(t.email_personal),1)):_("",!0)]),r("div",Ve,[r("div",null,[e[21]||(e[21]=r("label",{for:"dpi",class:"block text-sm font-medium text-gray-700 mb-1"},"DPI",-1)),N(r("input",{id:"dpi","onUpdate:modelValue":e[7]||(e[7]=a=>n(l).record.dpi=a),type:"text",placeholder:"10100101",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.dpi}])},null,2),[[A,n(l).record.dpi]]),t.dpi?(m(),c("p",Oe,g(t.dpi),1)):_("",!0)]),r("div",null,[e[22]||(e[22]=r("label",{for:"nit",class:"block text-sm font-medium text-gray-700 mb-1"},"NIT",-1)),N(r("input",{id:"nit","onUpdate:modelValue":e[8]||(e[8]=a=>n(l).record.nit=a),type:"text",placeholder:"1111-1",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.nit}])},null,2),[[A,n(l).record.nit]]),t.nit?(m(),c("p",Re,g(t.nit),1)):_("",!0)])]),r("div",null,[e[23]||(e[23]=r("label",{for:"address",class:"block text-sm font-medium text-gray-700 mb-1"},"Dirección",-1)),N(r("input",{id:"address","onUpdate:modelValue":e[9]||(e[9]=a=>n(l).record.address=a),type:"text",placeholder:"Calle Principal #123",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.address}])},null,2),[[A,n(l).record.address]]),t.address?(m(),c("p",Me,g(t.address),1)):_("",!0)]),r("div",Pe,[r("div",null,[e[24]||(e[24]=r("label",{for:"firstName",class:"block text-sm font-medium text-gray-700 mb-1"},"Municipio",-1)),N(r("input",{id:"firstName","onUpdate:modelValue":e[10]||(e[10]=a=>n(l).record.city=a),type:"text",placeholder:"Guatemala",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.city}])},null,2),[[A,n(l).record.city]]),t.city?(m(),c("p",je,g(t.city),1)):_("",!0)]),r("div",null,[e[25]||(e[25]=r("label",{for:"lastName",class:"block text-sm font-medium text-gray-700 mb-1"},"Departamento",-1)),N(r("input",{id:"lastName","onUpdate:modelValue":e[11]||(e[11]=a=>n(l).record.department=a),type:"text",placeholder:"Guatemala",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.department}])},null,2),[[A,n(l).record.department]]),t.department?(m(),c("p",Fe,g(t.department),1)):_("",!0)])]),r("div",null,[e[26]||(e[26]=r("label",{for:"address",class:"block text-sm font-medium text-gray-700 mb-1"},"Pais",-1)),N(r("input",{id:"address","onUpdate:modelValue":e[12]||(e[12]=a=>n(l).record.country=a),type:"text",placeholder:"Guatemala",class:E(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.country}])},null,2),[[A,n(l).record.country]]),t.country?(m(),c("p",Le,g(t.country),1)):_("",!0)]),r("button",{type:"submit",class:"w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",disabled:i.value},g(i.value?"Guardando...":"Guardar Perfil"),9,ze)],32)])]),D.value?(m(),c("div",Ge,g(T.value),1)):_("",!0),L(I,{errors:n(l).validationErrors},null,8,["errors"])])])),L(ue)],64)}}};export{st as default};
