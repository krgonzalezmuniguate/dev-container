import{_ as N,r as _,H as m,B,D,c as n,h as i,b as e,e as d,a as P,l as w,m as k,q as A,g as b,t as r,z as H,T as M,d as v,v as g,j as T,i as $,o as l}from"./index-CwaQPSV_.js";import{u as F,N as E}from"./newRequest-ndkV2YNW.js";import{u as G}from"./supply-yXzu10N6.js";import{H as Q}from"./Header-Cl2YdGa1.js";import{T as Y}from"./Top-B3CFE1E3.js";import{P as J}from"./Process-Be5-tuJY.js";import"./functions-BSmh5TsC.js";const K={class:"min-h-screen bg-slate-50 p-6"},O={key:0,class:"space-y-6"},W={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6"},X={class:"animate-pulse"},Z={class:"space-y-3"},ee={key:1,class:"max-w-4xl mx-auto"},se={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6"},te={class:"flex items-center justify-between mb-4"},oe={class:"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},de={class:"text-slate-900"},le={class:"text-slate-900"},ne={class:"text-slate-900"},re={class:"text-slate-900"},ie={class:"bg-slate-50 rounded-md p-3 border border-slate-200"},ue={class:"text-slate-800 leading-relaxed"},ce={key:1,class:"text-xs text-red-500"},pe={class:"flex justify-end mb-2"},me={class:"bg-white rounded-lg shadow-sm border border-slate-200 p-6"},be={class:"flex items-center justify-between mb-4"},ve=["disabled"],ge={class:"space-y-3"},fe={class:"flex-1"},xe={class:"w-32"},ye=["onUpdate:modelValue","max"],he=["onClick"],_e={class:"flex-1 items-center gap-4 p-4 bg-slate-50 rounded-lg border border-slate-200"},we={class:"text-right text-xs text-slate-500 mt-1"},ke={key:0,class:"text-center py-8 text-slate-500"},Se={class:"flex justify-end gap-3 mt-6 pt-4 border-t border-slate-200"},Ve=["disabled"],Le={__name:"ProcessingView",setup(je){const t=F(),f=G(),S=D(),x=T(),c=_(!1),y=_(!1),V=m(()=>{const s=new Date(t.records.created_at).getFullYear();return t.records.id+"-"+s}),L=m(()=>f.records.filter(o=>o.state==="1").map(o=>({...o,name:`${o.name} ( ${o.stock} )`})));let j=1;function C(o){const s=this.supplies.find(p=>p.id===o);return s?s.stock:99999}const R=m(()=>t.supplyLines.length>0&&t.supplyLines.every(o=>o.supplyId&&o.quantity>0)),h=()=>{t.supplyLines.length<10&&t.supplyLines.push({id:j++,supplyId:"",quantity:1})},z=o=>{t.supplyLines.splice(o,1)};h(),B(()=>{t.id=S.params.id,t.show(),f.index()});async function U(){await t.processing()===!0&&x.push({name:"manager"})}async function q(){c.value?t.reason_reject.length>=10?await t.reject(1)===!0&&x.push({name:"manager"}):y.value=!0:c.value=!0}return(o,s)=>{const p=$("Select");return l(),n("div",null,[i(Q),e("div",K,[d(t).loadingRecords?(l(),n("div",O,[s[8]||(s[8]=P('<div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6" data-v-3b1f7389><div class="animate-pulse" data-v-3b1f7389><div class="h-6 bg-slate-200 rounded w-1/3 mb-4" data-v-3b1f7389></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4" data-v-3b1f7389><div class="h-4 bg-slate-200 rounded" data-v-3b1f7389></div><div class="h-4 bg-slate-200 rounded" data-v-3b1f7389></div><div class="h-4 bg-slate-200 rounded" data-v-3b1f7389></div><div class="h-4 bg-slate-200 rounded" data-v-3b1f7389></div></div><div class="h-20 bg-slate-200 rounded" data-v-3b1f7389></div></div></div>',1)),e("div",W,[e("div",X,[s[6]||(s[6]=e("div",{class:"h-6 bg-slate-200 rounded w-1/4 mb-4"},null,-1)),e("div",Z,[(l(),n(w,null,k(3,a=>e("div",{key:a,class:"flex gap-4"},s[5]||(s[5]=[e("div",{class:"h-10 bg-slate-200 rounded flex-1"},null,-1),e("div",{class:"h-10 bg-slate-200 rounded w-24"},null,-1),e("div",{class:"h-10 bg-slate-200 rounded w-10"},null,-1)]))),64))]),s[7]||(s[7]=e("div",{class:"flex gap-3 mt-6"},[e("div",{class:"h-10 bg-slate-200 rounded w-24"}),e("div",{class:"h-10 bg-slate-200 rounded w-24"})],-1))])])])):(l(),n("div",ee,[e("div",se,[e("div",te,[s[9]||(s[9]=e("h1",{class:"text-2xl font-semibold text-slate-900"},"Procesar Solicitud",-1)),e("span",oe," #"+r(V.value),1)]),e("div",ae,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Usuario Solicitante",-1)),e("p",de,r(d(t).records.user),1)]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Usuario Aprobador",-1)),e("p",le,r(d(t).records.manager),1)]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Fecha de Solicitud",-1)),e("p",ne,r(d(t).records.created_at_format),1)]),e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Fecha de Aprobación",-1)),e("p",re,r(d(t).records.date_authorized_format),1)])]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Descripción de la Solicitud",-1)),e("div",ie,[e("p",ue,r(d(t).records.description),1)])])]),c.value?(l(),A(M,{key:0,name:"fade"},{default:H(()=>[v(e("textarea",{placeholder:"motivo de rechazo","onUpdate:modelValue":s[0]||(s[0]=a=>d(t).reason_reject=a),class:"w-full px-3 pt-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[g,d(t).reason_reject]])]),_:1})):b("",!0),y.value?(l(),n("span",ce," La razón del rechazo debe tener al menos 10 caracteres. ")):b("",!0),e("div",pe,[e("button",{onClick:s[1]||(s[1]=a=>q()),class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors duration-200 text-sm font-medium"}," Rechazar ")]),e("div",me,[e("div",be,[s[15]||(s[15]=e("h2",{class:"text-lg font-semibold text-slate-900"},"Suministros a Entregar",-1)),e("button",{onClick:h,disabled:d(t).supplyLines.length>=10,class:"px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors duration-200 text-sm font-medium"}," Agregar ",8,ve)]),e("div",ge,[(l(!0),n(w,null,k(d(t).supplyLines,(a,I)=>(l(),n("div",{key:a.id,class:"flex items-center gap-4 p-4 bg-slate-50 rounded-lg border border-slate-200"},[e("div",fe,[s[16]||(s[16]=e("label",{class:"block text-xs font-medium text-slate-600 mb-1"},"Suministro",-1)),i(p,{modelValue:a.supplyId,"onUpdate:modelValue":u=>a.supplyId=u,options:L.value,placeholder:"Seleccionar suministro...",class:"w-full px-3 py-2"},null,8,["modelValue","onUpdate:modelValue","options"])]),e("div",xe,[s[17]||(s[17]=e("label",{class:"block text-xs font-medium text-slate-600 mb-1"},"Cantidad",-1)),v(e("input",{"onUpdate:modelValue":u=>a.quantity=u,type:"number",min:"1",max:C(a.supplyId),class:"w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent",placeholder:"0"},null,8,ye),[[g,a.quantity,void 0,{number:!0}]])]),e("button",{onClick:u=>z(I),class:"mt-5 p-2 text-red-600 hover:bg-red-50 rounded-md transition-colors duration-200",title:"Eliminar línea"},s[18]||(s[18]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,he)]))),128)),e("div",_e,[s[19]||(s[19]=e("label",{class:"block text-xs font-medium text-slate-600 mb-1"},"Descripción",-1)),v(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=a=>d(t).description=a),maxlength:"255",class:"w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"},"                            ",512),[[g,d(t).description]]),e("p",we,r(d(t).description.length)+" / 255 ",1)]),d(t).supplyLines.length===0?(l(),n("div",ke,' No hay líneas de suministros. Haz clic en "Agregar" para comenzar. ')):b("",!0)]),e("div",Se,[e("button",{onClick:s[3]||(s[3]=()=>{}),class:"px-6 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 transition-colors duration-200 font-medium"}," Cancelar "),e("button",{onClick:s[4]||(s[4]=a=>U()),disabled:!R.value,class:"px-6 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors duration-200 font-medium"}," Guardar Procesamiento ",8,Ve)])])]))]),i(Y),i(E),i(J)])}}},Be=N(Le,[["__scopeId","data-v-3b1f7389"]]);export{Be as default};
